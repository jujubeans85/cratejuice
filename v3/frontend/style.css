/* CrateJuice v3 frontend â€” inline player with auto-fallback */

const MIMI_EMBED = "https://open.spotify.com/embed/track/7vxKPmBKOZiGKpeEHY7cpqe?theme=0";
const CBO_EMBED  = "https://open.spotify.com/embed/track/05WBvrtLeaq9F6PcwoNbm2N?theme=0";

const MIMI_LINK  = "https://open.spotify.com/track/7vxKPmBKOZiGKpeEHY7cpqe";
const CBO_LINK   = "https://open.spotify.com/track/05WBvrtLeaq9F6PcwoNbm2N";

// keep inline on, but we'll fail-safe to new tab
const INLINE = true;

function renderInline(src, direct) {
  const player = document.getElementById("player");
  if (!player) { window.open(direct, "_blank", "noopener"); return; }

  player.innerHTML = "";
  const iframe = document.createElement("iframe");
  iframe.src = src;
  iframe.width = "100%";
  iframe.height = "152";
  iframe.frameBorder = "0";
  iframe.allow = "autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture";
  iframe.loading = "lazy";
  iframe.style.borderRadius = "12px";
  iframe.referrerPolicy = "strict-origin-when-cross-origin";

  let loaded = false;
  iframe.addEventListener("load", () => { loaded = true; }, { once: true });

  player.appendChild(iframe);
  player.scrollIntoView({ behavior: "smooth", block: "center" });

  // if Spotify embed refuses to load (Safari/private mode/tracking), bail to new tab
  setTimeout(() => { if (!loaded) window.open(direct, "_blank", "noopener"); }, 2500);
}

function playMimi(){ INLINE ? renderInline(MIMI_EMBED, MIMI_LINK) : window.open(MIMI_LINK, "_blank", "noopener"); }
function playCbo(){  INLINE ? renderInline(CBO_EMBED,  CBO_LINK)  : window.open(CBO_LINK,  "_blank", "noopener"); }

document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("btnMimi")?.addEventListener("click", playMimi);
  document.getElementById("btnCbo") ?.addEventListener("click", playCbo);
});
